# Система авторизации - Обновленная инструкция

## Как работает система входа

### **При запуске приложения:**

1. **Открывается окно входа** с полями:
   - **Логин** (по умолчанию: `admin`)
   - **Пароль** (по умолчанию: `123`)

2. **Два способа входа:**

#### **🔑 Вход как Администратор:**
- **Логин:** `admin`
- **Пароль:** `123`
- **Права:** Полный доступ ко всем функциям

#### **👤 Вход как Обычный пользователь:**
- **Логин:** Любое имя (например: `Иван`, `Мария`, `Петр`)
- **Пароль:** Любой (не проверяется)
- **Права:** Только просмотр фильмов и создание бронирований

### **Права доступа по ролям:**

#### **Администратор (Admin):**
✅ **Может:**
- Добавлять, редактировать, удалять фильмы
- Добавлять, редактировать, удалять сеансы
- Добавлять, редактировать, удалять пользователей
- Просматривать все бронирования
- Отменять бронирования
- Просматривать билеты
- Управлять системой

❌ **Не может:**
- Нет ограничений

#### **Обычный пользователь (User):**
✅ **Может:**
- Просматривать фильмы (только чтение)
- Создавать бронирования **только на себя**
- Просматривать **только свои бронирования**
- Отменять **только свои бронирования**
- Просматривать **только свои билеты**
- Отменять **отдельные билеты** в своих бронированиях
- Использовать поиск и фильтрацию по своим данным

❌ **Не может:**
- Добавлять/редактировать/удалять фильмы
- Добавлять/редактировать/удалять сеансы
- Добавлять/редактировать/удалять пользователей
- Отменять **чужие бронирования**
- Просматривать **чужие билеты**
- Создавать бронирования **от имени других пользователей**
- Доступ к административным функциям

### **Интерфейс системы:**

#### **Окно входа:**
- Красивый дизайн с заголовком
- Поля логина и пароля
- Кнопки "Войти" и "Отмена"
- Статусная строка с сообщениями
- Подсказка: "Админ: admin / 123" и "Пользователь: введите свое имя"

#### **Главное окно для Администратора:**
- Заголовок показывает имя и роль пользователя
- 4 вкладки: Фильмы, Сеансы, Бронирования, Пользователи
- Все кнопки управления доступны
- Полный доступ ко всем функциям

#### **Главное окно для Обычного пользователя:**
- Заголовок показывает имя и роль пользователя
- 2 вкладки: Фильмы, Бронирования
- Вкладки "Сеансы" и "Пользователи" скрыты
- В разделе "Фильмы" только таблица (без кнопок добавления/редактирования)
- В разделе "Бронирования" только кнопка "Новое бронирование"

### **Примеры использования:**

#### **Сценарий 1: Вход администратора**
1. Запустите приложение
2. Введите `admin` в поле логина
3. Введите `123` в поле пароля
4. Нажмите "Войти"
5. Откроется главное окно с 4 вкладками и полным доступом

#### **Сценарий 2: Вход обычного пользователя**
1. Запустите приложение
2. Введите любое имя (например: `Иван`)
3. Введите любой пароль
4. Нажмите "Войти"
5. Откроется главное окно с 2 вкладками и ограниченным доступом

#### **Сценарий 3: Создание бронирования пользователем**
1. Войдите как обычный пользователь
2. Перейдите на вкладку "Бронирования"
3. Нажмите "Новое бронирование"
4. Выберите фильм и сеанс
5. Выберите места и создайте бронирование

#### **Сценарий 4: Попытка доступа к админ-функциям**
1. Войдите как обычный пользователь
2. Попробуйте найти кнопки "Добавить фильм" - их не будет
3. Попробуйте найти вкладки "Сеансы" и "Пользователи" - их не будет
4. Попробуйте нажать "Отменить бронь" - кнопки не будет

### **Безопасность:**

- **Администратор:** Фиксированные учетные данные (admin/123)
- **Пользователи:** Любое имя без проверки пароля
- **Автоматическое создание:** Если имя не найдено в БД, создается временный пользователь
- **Ограничения интерфейса:** Административные функции полностью скрыты для обычных пользователей

### **Настройка:**

#### **Изменение пароля администратора:**
В файле `Forms/LoginForm.cs` найдите строку:
```csharp
if (txtLogin.Text.ToLower() == "admin" && txtPassword.Text == "123")
```
Измените `"123"` на нужный пароль.

#### **Добавление проверки паролей пользователей:**
1. Добавьте поле `password` в таблицу `User`
2. Обновите модель `User`
3. Измените логику проверки в `LoginForm.cs`

### **Устранение неполадок:**

#### **Проблема: "Ошибка авторизации"**
- Проверьте подключение к базе данных
- Убедитесь, что таблица `User` существует
- Проверьте строку подключения

#### **Проблема: "Неверный логин или пароль"**
- Для администратора: проверьте логин `admin` и пароль `123`
- Для пользователя: убедитесь, что ввели имя (не email)

#### **Проблема: "Доступ запрещен"**
- Это нормальное поведение для обычных пользователей
- Войдите как администратор для полного доступа

### **Дополнительные возможности:**

#### **Добавление новых ролей:**
1. Добавьте роль в таблицу `Roles`
2. Обновите логику проверки в `MainForm.cs`
3. Добавьте соответствующие права доступа

#### **Логирование входов:**
Можно добавить таблицу `LoginLog` для отслеживания входов в систему.

#### **Автоматический выход:**
Можно добавить таймер для автоматического выхода через определенное время.

---

## **🆕 Новые функции безопасности**

### **🔒 Личные бронирования**
- **Обычные пользователи** видят только свои бронирования
- **Фильтрация данных** по имени пользователя
- **Защита от просмотра** чужих данных

### **🎫 Ограниченная форма создания бронирования**
- **Обычные пользователи** могут создавать бронирования только на себя
- **Поле пользователя заблокировано** для обычных пользователей
- **Администраторы** сохраняют полный контроль

### **🎟️ Управление отдельными билетами**
- **Отмена отдельных билетов** вместо всего бронирования
- **Автоматический пересчет** суммы бронирования
- **Проверка доступа** к билетам других пользователей

### **🔍 Поиск и фильтрация**
- **Поиск по всем столбцам** таблиц
- **Фильтрация по операторам** (=, !=, содержит, >, < и др.)
- **Статусная строка** с количеством найденных записей

---

## **Готово к использованию! 🎉**

Система авторизации полностью настроена и готова к работе. Теперь при запуске приложения будет запрашиваться вход с проверкой ролей и соответствующими правами доступа.

### **Ключевые особенности:**
- **Простой вход для пользователей:** Любое имя без регистрации
- **Ограниченный интерфейс:** Только нужные функции для каждой роли
- **Безопасность:** Административные функции полностью скрыты
- **Удобство:** Автоматическое создание временных пользователей
- **🆕 Изоляция данных:** Каждый видит только свои данные
- **🆕 Гибкое управление:** Отмена отдельных билетов
- **🆕 Мощный поиск:** По всем столбцам с фильтрацией

# SQL –§—É–Ω–∫—Ü–∏–∏ –∏ –ü—Ä–æ—Ü–µ–¥—É—Ä—ã –¥–ª—è CinemaBookingApp

## –û–±–∑–æ—Ä

–≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–æ—Å—Ç—ã–µ SQL —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Ö—Ä–∞–Ω–∏–º—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –±–∏–ª–µ—Ç–æ–≤ –≤ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–µ.

---

## üîß **–§—É–Ω–∫—Ü–∏—è 1: –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –±–∏–ª–µ—Ç–∞**

### –û–ø–∏—Å–∞–Ω–∏–µ
–§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –±–∏–ª–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑–æ–≤–æ–π —Ü–µ–Ω—ã –∏ —Ç–∏–ø–∞ –∑–∞–ª–∞.

```sql
-- =============================================
-- –§—É–Ω–∫—Ü–∏—è: –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –±–∏–ª–µ—Ç–∞
-- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –±–∏–ª–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑–æ–≤–æ–π —Ü–µ–Ω—ã –∏ —Ç–∏–ø–∞ –∑–∞–ª–∞
-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: @BasePrice - –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ –±–∏–ª–µ—Ç–∞, @HallTypeId - ID —Ç–∏–ø–∞ –∑–∞–ª–∞
-- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: DECIMAL(10,2) - —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –±–∏–ª–µ—Ç–∞
-- =============================================
CREATE FUNCTION dbo.CalculateTicketPrice(
    @BasePrice DECIMAL(10,2),    -- –í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä: –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ –±–∏–ª–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 300.00)
    @HallTypeId INT              -- –í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä: –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–∏–ø–∞ –∑–∞–ª–∞ (1=–û–±—ã—á–Ω—ã–π, 2=3D, 3=VIP)
)
RETURNS DECIMAL(10,2)            -- –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Ç–∏–ø: –¥–µ—Å—è—Ç–∏—á–Ω–æ–µ —á–∏—Å–ª–æ —Å 2 –∑–Ω–∞–∫–∞–º–∏ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
AS
BEGIN
    -- –û–±—ä—è–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
    DECLARE @Multiplier DECIMAL(3,2);  -- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–Ω–æ–∂–∏—Ç–µ–ª—è —Ü–µ–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1.5 –¥–ª—è 3D)
    DECLARE @FinalPrice DECIMAL(10,2); -- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–æ–π —Ü–µ–Ω—ã
    
    -- –ü–æ–ª—É—á–∞–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å —Ü–µ–Ω—ã –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –∑–∞–ª–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã Hall_Type
    SELECT @Multiplier = price_per_seat  -- –ò–∑–≤–ª–µ–∫–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è price_per_seat (–º–Ω–æ–∂–∏—Ç–µ–ª—å —Ü–µ–Ω—ã)
    FROM Hall_Type                       -- –ò–∑ —Ç–∞–±–ª–∏—Ü—ã —Ç–∏–ø–æ–≤ –∑–∞–ª–æ–≤
    WHERE hall_type_id = @HallTypeId;    -- –ì–¥–µ ID —Ç–∏–ø–∞ –∑–∞–ª–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º
    
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ –Ω–∞–π–¥–µ–Ω —Ç–∏–ø –∑–∞–ª–∞ (–µ—Å–ª–∏ SELECT –Ω–µ –≤–µ—Ä–Ω—É–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç, @Multiplier –±—É–¥–µ—Ç NULL)
    IF @Multiplier IS NULL
        SET @Multiplier = 1.0;           -- –ï—Å–ª–∏ —Ç–∏–ø –∑–∞–ª–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é = 1.0
    
    -- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Ü–µ–Ω—É –±–∏–ª–µ—Ç–∞: –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ —É–º–Ω–æ–∂–∞–µ—Ç—Å—è –Ω–∞ –º–Ω–æ–∂–∏—Ç–µ–ª—å —Ç–∏–ø–∞ –∑–∞–ª–∞
    SET @FinalPrice = @BasePrice * @Multiplier;  -- –ù–∞–ø—Ä–∏–º–µ—Ä: 300.00 * 1.5 = 450.00
    
    -- –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—É—é —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Ü–µ–Ω—É –±–∏–ª–µ—Ç–∞
    RETURN @FinalPrice;
END;
GO
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:
```sql
-- –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏
SELECT 
    m.title AS movie_title,
    ht.type_name AS hall_type,
    dbo.CalculateTicketPrice(300.00, ht.hall_type_id) AS ticket_price
FROM Movie m
CROSS JOIN Hall_Type ht
WHERE m.movie_id = 1;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
movie_title | hall_type | ticket_price
------------|-----------|-------------
–ê–≤–∞—Ç–∞—Ä      | –û–±—ã—á–Ω—ã–π   | 300.00
–ê–≤–∞—Ç–∞—Ä      | 3D        | 450.00
–ê–≤–∞—Ç–∞—Ä      | VIP       | 600.00
```

---

## üìä **–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ 1: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**

### –û–ø–∏—Å–∞–Ω–∏–µ
–•—Ä–∞–Ω–∏–º–∞—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞—Å—á–µ—Ç–æ–º —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ–º –±–∏–ª–µ—Ç–æ–≤.

```sql
-- =============================================
-- –ü—Ä–æ—Ü–µ–¥—É—Ä–∞: –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å –±–∏–ª–µ—Ç–∞–º–∏
-- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞—Å—á–µ—Ç–æ–º —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ–º –±–∏–ª–µ—Ç–æ–≤
-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: @UserId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, @ScreeningId - ID —Å–µ–∞–Ω—Å–∞, @SeatNumbers - —Å–ø–∏—Å–æ–∫ –º–µ—Å—Ç —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
--           @BasePrice - –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞, @BookingId - –≤—ã—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä —Å ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
-- =============================================
CREATE PROCEDURE dbo.CreateBookingWithTickets
    @UserId INT,                           -- –í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä: –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    @ScreeningId INT,                      -- –í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä: –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–µ–∞–Ω—Å–∞
    @SeatNumbers NVARCHAR(MAX),            -- –í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä: —Å–ø–∏—Å–æ–∫ –º–µ—Å—Ç —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: "A1,A2,A3")
    @BasePrice DECIMAL(10,2),              -- –í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä: –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ –±–∏–ª–µ—Ç–∞
    @BookingId INT OUTPUT                  -- –í—ã—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä: ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø–æ —Å—Å—ã–ª–∫–µ)
AS
BEGIN
    SET NOCOUNT ON;                        -- –û—Ç–∫–ª—é—á–∞–µ–º –≤—ã–≤–æ–¥ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
    
    -- –û–±—ä—è–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
    DECLARE @TotalAmount DECIMAL(10,2) = 0;    -- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –æ–±—â–µ–π —Å—É–º–º—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω—É–ª–µ–º)
    DECLARE @TicketPrice DECIMAL(10,2);        -- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ü–µ–Ω—ã –æ–¥–Ω–æ–≥–æ –±–∏–ª–µ—Ç–∞
    DECLARE @HallTypeId INT;                   -- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è ID —Ç–∏–ø–∞ –∑–∞–ª–∞
    DECLARE @SeatNumber NVARCHAR(10);          -- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –Ω–æ–º–µ—Ä–∞ –º–µ—Å—Ç–∞ –≤ —Ü–∏–∫–ª–µ
    DECLARE @SeatList TABLE (seat_number NVARCHAR(10)); -- –í—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –º–µ—Å—Ç
    
    BEGIN TRY                                -- –ù–∞—á–∏–Ω–∞–µ–º –±–ª–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
        BEGIN TRANSACTION;                   -- –ù–∞—á–∏–Ω–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
        
        -- –ü–æ–ª—É—á–∞–µ–º —Ç–∏–ø –∑–∞–ª–∞ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Å–µ–∞–Ω—Å–∞ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        SELECT @HallTypeId = h.hall_type_id  -- –ò–∑–≤–ª–µ–∫–∞–µ–º ID —Ç–∏–ø–∞ –∑–∞–ª–∞
        FROM Screening s                     -- –ò–∑ —Ç–∞–±–ª–∏—Ü—ã —Å–µ–∞–Ω—Å–æ–≤ (–∞–ª–∏–∞—Å s)
        INNER JOIN Cinema_Hall h ON s.hall_id = h.hall_id  -- –°–æ–µ–¥–∏–Ω—è–µ–º —Å —Ç–∞–±–ª–∏—Ü–µ–π –∑–∞–ª–æ–≤ –ø–æ hall_id
        WHERE s.screening_id = @ScreeningId; -- –ì–¥–µ ID —Å–µ–∞–Ω—Å–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º
        
        -- –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ –Ω–∞–π–¥–µ–Ω —Å–µ–∞–Ω—Å (–µ—Å–ª–∏ SELECT –Ω–µ –≤–µ—Ä–Ω—É–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç, @HallTypeId –±—É–¥–µ—Ç NULL)
        IF @HallTypeId IS NULL
        BEGIN
            RAISERROR('–°–µ–∞–Ω—Å –Ω–µ –Ω–∞–π–¥–µ–Ω', 16, 1);  -- –í—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –∏ –∫–æ–¥–æ–º –æ—à–∏–±–∫–∏
            RETURN;                                -- –í—ã—Ö–æ–¥–∏–º –∏–∑ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
        END
        
        -- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ü–µ–Ω—É –±–∏–ª–µ—Ç–∞ —Å –ø–æ–º–æ—â—å—é –Ω–∞—à–µ–π —Ñ—É–Ω–∫—Ü–∏–∏ CalculateTicketPrice
        SET @TicketPrice = dbo.CalculateTicketPrice(@BasePrice, @HallTypeId);  -- –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–Ω—ã
        
        -- –†–∞–∑–±–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É —Å –Ω–æ–º–µ—Ä–∞–º–∏ –º–µ—Å—Ç –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–µ—Å—Ç–∞ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
        INSERT INTO @SeatList (seat_number)  -- –í—Å—Ç–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É @SeatList
        SELECT LTRIM(RTRIM(value))           -- –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã —Å–ª–µ–≤–∞ –∏ —Å–ø—Ä–∞–≤–∞ –æ—Ç –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
        FROM STRING_SPLIT(@SeatNumbers, ','); -- –†–∞–∑–±–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É –ø–æ –∑–∞–ø—è—Ç–æ–π –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        
        -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –º–µ—Å—Ç –Ω–∞ —Å–µ–∞–Ω—Å–µ
        IF EXISTS (                          -- –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –∑–∞–Ω—è—Ç–æ–µ –º–µ—Å—Ç–æ
            SELECT 1                         -- –í—ã–±–∏—Ä–∞–µ–º –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É 1 (–¥–ª—è EXISTS –≤–∞–∂–µ–Ω —Ç–æ–ª—å–∫–æ —Ñ–∞–∫—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è)
            FROM @SeatList sl                -- –ò–∑ –Ω–∞—à–µ–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –º–µ—Å—Ç (–∞–ª–∏–∞—Å sl)
            INNER JOIN Ticket t ON sl.seat_number = t.seat_number  -- –°–æ–µ–¥–∏–Ω—è–µ–º —Å —Ç–∞–±–ª–∏—Ü–µ–π –±–∏–ª–µ—Ç–æ–≤ –ø–æ –Ω–æ–º–µ—Ä—É –º–µ—Å—Ç–∞
            INNER JOIN Screening s ON t.screening_id = s.screening_id  -- –°–æ–µ–¥–∏–Ω—è–µ–º —Å —Ç–∞–±–ª–∏—Ü–µ–π —Å–µ–∞–Ω—Å–æ–≤
            INNER JOIN Booking b ON t.booking_id = b.booking_id      -- –°–æ–µ–¥–∏–Ω—è–µ–º —Å —Ç–∞–±–ª–∏—Ü–µ–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
            WHERE s.screening_id = @ScreeningId  -- –ì–¥–µ ID —Å–µ–∞–Ω—Å–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –Ω–∞—à–∏–º —Å–µ–∞–Ω—Å–æ–º
                AND b.status = 'COMPLETED'        -- –ò —Å—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è "–∑–∞–≤–µ—Ä—à–µ–Ω–æ" (–º–µ—Å—Ç–æ –∑–∞–Ω—è—Ç–æ)
        )
        BEGIN
            RAISERROR('–û–¥–Ω–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Å—Ç —É–∂–µ –∑–∞–Ω—è—Ç—ã', 16, 1);  -- –í—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –æ –∑–∞–Ω—è—Ç—ã—Ö –º–µ—Å—Ç–∞—Ö
            RETURN;                                                      -- –í—ã—Ö–æ–¥–∏–º –∏–∑ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
        END
        
        -- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â—É—é —Å—É–º–º—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        SET @TotalAmount = @TicketPrice * (SELECT COUNT(*) FROM @SeatList);  -- –¶–µ–Ω–∞ –±–∏–ª–µ—Ç–∞ —É–º–Ω–æ–∂–∞–µ—Ç—Å—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç
        
        -- –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü–µ Booking
        INSERT INTO Booking (user_id, order_date, total_amount, status)  -- –í—Å—Ç–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
        VALUES (@UserId, GETDATE(), @TotalAmount, 'PENDING');             -- –ó–Ω–∞—á–µ–Ω–∏—è: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞, –æ–±—â–∞—è —Å—É–º–º–∞, —Å—Ç–∞—Ç—É—Å "–æ–∂–∏–¥–∞–µ—Ç"
        
        SET @BookingId = SCOPE_IDENTITY();  -- –ü–æ–ª—É—á–∞–µ–º ID —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏ (–∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç)
        
        -- –°–æ–∑–¥–∞–µ–º –±–∏–ª–µ—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—Ç–∞ —Å –ø–æ–º–æ—â—å—é –∫—É—Ä—Å–æ—Ä–∞
        DECLARE seat_cursor CURSOR FOR       -- –û–±—ä—è–≤–ª—è–µ–º –∫—É—Ä—Å–æ—Ä –¥–ª—è –ø–µ—Ä–µ–±–æ—Ä–∞ –º–µ—Å—Ç
        SELECT seat_number FROM @SeatList;   -- –í—ã–±–∏—Ä–∞–µ–º –≤—Å–µ –Ω–æ–º–µ—Ä–∞ –º–µ—Å—Ç –∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
        
        OPEN seat_cursor;                    -- –û—Ç–∫—Ä—ã–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã
        FETCH NEXT FROM seat_cursor INTO @SeatNumber;  -- –ß–∏—Ç–∞–µ–º –ø–µ—Ä–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é @SeatNumber
        
        WHILE @@FETCH_STATUS = 0            -- –ü–æ–∫–∞ –∫—É—Ä—Å–æ—Ä –Ω–µ –¥–æ—Å—Ç–∏–≥ –∫–æ–Ω—Ü–∞ –¥–∞–Ω–Ω—ã—Ö (@@FETCH_STATUS = 0)
        BEGIN
            -- –°–æ–∑–¥–∞–µ–º –±–∏–ª–µ—Ç –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—Ç–∞
            INSERT INTO Ticket (booking_id, seat_number, price, screening_id)  -- –í—Å—Ç–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –±–∏–ª–µ—Ç
            VALUES (@BookingId, @SeatNumber, @TicketPrice, @ScreeningId);    -- –ó–Ω–∞—á–µ–Ω–∏—è: ID –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–æ–º–µ—Ä –º–µ—Å—Ç–∞, —Ü–µ–Ω–∞, ID —Å–µ–∞–Ω—Å–∞
            
            FETCH NEXT FROM seat_cursor INTO @SeatNumber;  -- –ß–∏—Ç–∞–µ–º —Å–ª–µ–¥—É—é—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –∫—É—Ä—Å–æ—Ä–∞
        END
        
        CLOSE seat_cursor;                   -- –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä
        DEALLOCATE seat_cursor;              -- –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–∞–º—è—Ç—å, –∑–∞–Ω—è—Ç—É—é –∫—É—Ä—Å–æ—Ä–æ–º
        
        COMMIT TRANSACTION;                  -- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (—Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
        
        -- –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ–∑–¥–∞–Ω–Ω–æ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        SELECT 
            @BookingId AS booking_id,       -- ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            @TotalAmount AS total_amount,   -- –û–±—â–∞—è —Å—É–º–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            @TicketPrice AS ticket_price,    -- –¶–µ–Ω–∞ –æ–¥–Ω–æ–≥–æ –±–∏–ª–µ—Ç–∞
            (SELECT COUNT(*) FROM @SeatList) AS tickets_count;  -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∏–ª–µ—Ç–æ–≤
            
    END TRY                                  -- –ö–æ–Ω–µ—Ü –±–ª–æ–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
    BEGIN CATCH                              -- –ë–ª–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
        IF @@TRANCOUNT > 0                   -- –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
            ROLLBACK TRANSACTION;            -- –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–≤–æ–∑–≤—Ä–∞—â–∞–µ–º –±–∞–∑—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
            
        -- –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–µ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        DECLARE @ErrorMessage NVARCHAR(4000) = ERROR_MESSAGE();  -- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        DECLARE @ErrorSeverity INT = ERROR_SEVERITY();         -- –£—Ä–æ–≤–µ–Ω—å —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏ –æ—à–∏–±–∫–∏
        DECLARE @ErrorState INT = ERROR_STATE();               -- –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—à–∏–±–∫–∏
        
        RAISERROR(@ErrorMessage, @ErrorSeverity, @ErrorState); -- –ü–µ—Ä–µ–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –Ω–∞–≤–µ—Ä—Ö
    END CATCH                                -- –ö–æ–Ω–µ—Ü –±–ª–æ–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
END;
GO
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã:
```sql
-- –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
DECLARE @NewBookingId INT;
DECLARE @UserId INT = 1;
DECLARE @ScreeningId INT = 1;
DECLARE @SeatNumbers NVARCHAR(MAX) = 'A1,A2,A3';
DECLARE @BasePrice DECIMAL(10,2) = 300.00;

EXEC dbo.CreateBookingWithTickets 
    @UserId = @UserId,
    @ScreeningId = @ScreeningId,
    @SeatNumbers = @SeatNumbers,
    @BasePrice = @BasePrice,
    @BookingId = @NewBookingId OUTPUT;

PRINT '–°–æ–∑–¥–∞–Ω–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å ID: ' + CAST(@NewBookingId AS VARCHAR(10));
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
booking_id | total_amount | ticket_price | tickets_count
-----------|--------------|--------------|--------------
123        | 900.00       | 300.00       | 3
```

---

## üîç **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**

### –§—É–Ω–∫—Ü–∏—è 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–µ—Å—Ç–∞

```sql
-- =============================================
-- –§—É–Ω–∫—Ü–∏—è: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–µ—Å—Ç–∞
-- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–≤–æ–±–æ–¥–Ω–æ –ª–∏ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Å–µ–∞–Ω—Å–µ
-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: @ScreeningId - ID —Å–µ–∞–Ω—Å–∞, @SeatNumber - –Ω–æ–º–µ—Ä –º–µ—Å—Ç–∞
-- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: BIT - 1 –µ—Å–ª–∏ –º–µ—Å—Ç–æ —Å–≤–æ–±–æ–¥–Ω–æ, 0 –µ—Å–ª–∏ –∑–∞–Ω—è—Ç–æ
-- =============================================
CREATE FUNCTION dbo.IsSeatAvailable(
    @ScreeningId INT,                    -- –í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä: –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–µ–∞–Ω—Å–∞
    @SeatNumber NVARCHAR(10)             -- –í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä: –Ω–æ–º–µ—Ä –º–µ—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "A15")
)
RETURNS BIT                              -- –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Ç–∏–ø: –±–∏—Ç–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (0 –∏–ª–∏ 1)
AS
BEGIN
    DECLARE @IsAvailable BIT = 1;       -- –û–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ–º 1 (–º–µ—Å—Ç–æ —Å–≤–æ–±–æ–¥–Ω–æ)
    
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –±–∏–ª–µ—Ç –Ω–∞ —ç—Ç–æ –º–µ—Å—Ç–æ —Å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
    IF EXISTS (                          -- –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏
        SELECT 1                        -- –í—ã–±–∏—Ä–∞–µ–º –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É 1 (–¥–ª—è EXISTS –≤–∞–∂–µ–Ω —Ç–æ–ª—å–∫–æ —Ñ–∞–∫—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è)
        FROM Ticket t                   -- –ò–∑ —Ç–∞–±–ª–∏—Ü—ã –±–∏–ª–µ—Ç–æ–≤ (–∞–ª–∏–∞—Å t)
        INNER JOIN Booking b ON t.booking_id = b.booking_id  -- –°–æ–µ–¥–∏–Ω—è–µ–º —Å —Ç–∞–±–ª–∏—Ü–µ–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –ø–æ ID –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        WHERE t.screening_id = @ScreeningId    -- –ì–¥–µ ID —Å–µ–∞–Ω—Å–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º
            AND t.seat_number = @SeatNumber   -- –ò –Ω–æ–º–µ—Ä –º–µ—Å—Ç–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º
            AND b.status = 'COMPLETED'         -- –ò —Å—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è "–∑–∞–≤–µ—Ä—à–µ–Ω–æ" (–º–µ—Å—Ç–æ –∑–∞–Ω—è—Ç–æ)
    )
        SET @IsAvailable = 0;           -- –ï—Å–ª–∏ –º–µ—Å—Ç–æ –∑–∞–Ω—è—Ç–æ, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ 0
    
    RETURN @IsAvailable;                -- –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ (1 - —Å–≤–æ–±–æ–¥–Ω–æ, 0 - –∑–∞–Ω—è—Ç–æ)
END;
GO
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–µ—Å—Ç–∞
SELECT 
    s.screening_id,
    m.title,
    'A10' AS seat_number,
    dbo.IsSeatAvailable(s.screening_id, 'A10') AS is_available
FROM Screening s
INNER JOIN Movie m ON s.movie_id = m.movie_id
WHERE s.screening_id = 1;
```

### –§—É–Ω–∫—Ü–∏—è 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

```sql
-- =============================================
-- –§—É–Ω–∫—Ü–∏—è: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
-- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: @UserId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
-- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: TABLE - —Ç–∞–±–ª–∏—Ü–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
-- =============================================
CREATE FUNCTION dbo.GetUserInfo(@UserId INT)  -- –í—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä: –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
RETURNS TABLE                                  -- –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Ç–∏–ø: —Ç–∞–±–ª–∏—Ü–∞ (table-valued function)
AS
RETURN
(
    SELECT 
        u.user_id,                            -- ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        u.name,                               -- –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        u.email,                              -- Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        u.phone,                              -- –¢–µ–ª–µ—Ñ–æ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        r.role_name,                          -- –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        COUNT(b.booking_id) AS total_bookings, -- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        SUM(CASE WHEN b.status = 'COMPLETED' THEN b.total_amount ELSE 0 END) AS total_spent  -- –û–±—â–∞—è –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω–∞—è —Å—É–º–º–∞ (—Ç–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)
    FROM [User] u                             -- –ò–∑ —Ç–∞–±–ª–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∞–ª–∏–∞—Å u)
    INNER JOIN Roles r ON u.role_id = r.role_id  -- –°–æ–µ–¥–∏–Ω—è–µ–º —Å —Ç–∞–±–ª–∏—Ü–µ–π —Ä–æ–ª–µ–π –ø–æ ID —Ä–æ–ª–∏
    LEFT JOIN Booking b ON u.user_id = b.user_id  -- –õ–µ–≤—ã–π –¥–∂–æ–π–Ω —Å —Ç–∞–±–ª–∏—Ü–µ–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π (–º–æ–∂–µ—Ç –±—ã—Ç—å NULL)
    WHERE u.user_id = @UserId                 -- –ì–¥–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º
    GROUP BY u.user_id, u.name, u.email, u.phone, r.role_name  -- –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –ø–æ–ª—è–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
);
GO
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
```sql
-- –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
SELECT * FROM dbo.GetUserInfo(1);
```

---

## üìã **–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π**

### –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏:
```sql
-- =============================================
-- –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
-- –î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
-- =============================================

-- –û–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
DECLARE @UserId INT = 1;                    -- ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1)
DECLARE @ScreeningId INT = 1;               -- ID —Å–µ–∞–Ω—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1)
DECLARE @SeatNumber NVARCHAR(10) = 'B15';   -- –ù–æ–º–µ—Ä –º–µ—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "B15")
DECLARE @BasePrice DECIMAL(10,2) = 300.00;  -- –ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ –±–∏–ª–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 300.00 —Ä—É–±–ª–µ–π)
DECLARE @NewBookingId INT;                  -- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–µ—Å—Ç–∞ —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ IsSeatAvailable
IF dbo.IsSeatAvailable(@ScreeningId, @SeatNumber) = 1  -- –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –≤–µ—Ä–Ω—É–ª–∞ 1 (–º–µ—Å—Ç–æ —Å–≤–æ–±–æ–¥–Ω–æ)
BEGIN
    -- –°–æ–∑–¥–∞–µ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é –ø—Ä–æ—Ü–µ–¥—É—Ä—ã CreateBookingWithTickets
    EXEC dbo.CreateBookingWithTickets 
        @UserId = @UserId,                   -- –ü–µ—Ä–µ–¥–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        @ScreeningId = @ScreeningId,         -- –ü–µ—Ä–µ–¥–∞–µ–º ID —Å–µ–∞–Ω—Å–∞
        @SeatNumbers = @SeatNumber,         -- –ü–µ—Ä–µ–¥–∞–µ–º –Ω–æ–º–µ—Ä –º–µ—Å—Ç–∞
        @BasePrice = @BasePrice,            -- –ü–µ—Ä–µ–¥–∞–µ–º –±–∞–∑–æ–≤—É—é —Ü–µ–Ω—É
        @BookingId = @NewBookingId OUTPUT;  -- –ü–æ–ª—É—á–∞–µ–º ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    
    -- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ GetUserInfo
    SELECT * FROM dbo.GetUserInfo(@UserId); -- –í—ã–≤–æ–¥–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    
    -- –í—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    PRINT '–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ!';  -- –í—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å
END
ELSE                                        -- –ï—Å–ª–∏ –º–µ—Å—Ç–æ –∑–∞–Ω—è—Ç–æ (—Ñ—É–Ω–∫—Ü–∏—è –≤–µ—Ä–Ω—É–ª–∞ 0)
BEGIN
    -- –í—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –º–µ—Å—Ç–æ –∑–∞–Ω—è—Ç–æ
    PRINT '–ú–µ—Å—Ç–æ ' + @SeatNumber + ' —É–∂–µ –∑–∞–Ω—è—Ç–æ!';  -- –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–æ–º–µ—Ä–æ–º –º–µ—Å—Ç–∞
END
```

---

## üéØ **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**

–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç:

### **üîß –§—É–Ω–∫—Ü–∏—è CalculateTicketPrice:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –±–∏–ª–µ—Ç–∞
- –£—á–µ—Ç —Ç–∏–ø–∞ –∑–∞–ª–∞ –∏ –±–∞–∑–æ–≤–æ–π —Ü–µ–Ω—ã
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (–µ—Å–ª–∏ —Ç–∏–ø –∑–∞–ª–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω)

### **üìä –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ CreateBookingWithTickets:**
- –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞—Å—á–µ—Ç–æ–º
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–µ—Å—Ç
- –°–æ–∑–¥–∞–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—Ç–∞
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –æ—Ç–∫–∞—Ç–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π

### **üí° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞** - —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –∏–∑ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å** - –ø–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

**–§—É–Ω–∫—Ü–∏–∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ —Å–∏—Å—Ç–µ–º–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è!** üöÄ

